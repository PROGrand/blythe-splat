var K=Object.defineProperty;var D=(n,t,e)=>t in n?K(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _=(n,t,e)=>D(n,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill.js";import{r,_ as i,R,G as g,O as T,S as f,a as I,Q as w,V as h,D as A,C,E as O,b,A as V,I as M,H as X,c as L,M as S,d as F,e as x}from"./babylonjs.js";import{D as Y}from"./luxon.js";import{V as B,F as G,s as k}from"./fullscreen.js";function z(){r("EXT_lights_image_based",!0,async n=>{const{EXT_lights_image_based:t}=await i(async()=>{const{EXT_lights_image_based:e}=await import("./babylonjs.js").then(a=>a.f);return{EXT_lights_image_based:e}},[]);return new t(n)}),r("EXT_mesh_gpu_instancing",!0,async n=>{const{EXT_mesh_gpu_instancing:t}=await i(async()=>{const{EXT_mesh_gpu_instancing:e}=await import("./babylonjs.js").then(a=>a.h);return{EXT_mesh_gpu_instancing:e}},[]);return new t(n)}),r("EXT_meshopt_compression",!0,async n=>{const{EXT_meshopt_compression:t}=await i(async()=>{const{EXT_meshopt_compression:e}=await import("./babylonjs.js").then(a=>a.i);return{EXT_meshopt_compression:e}},[]);return new t(n)}),r("EXT_texture_avif",!0,async n=>{const{EXT_texture_avif:t}=await i(async()=>{const{EXT_texture_avif:e}=await import("./babylonjs.js").then(a=>a.j);return{EXT_texture_avif:e}},[]);return new t(n)}),r("EXT_texture_webp",!0,async n=>{const{EXT_texture_webp:t}=await i(async()=>{const{EXT_texture_webp:e}=await import("./babylonjs.js").then(a=>a.k);return{EXT_texture_webp:e}},[]);return new t(n)}),r("ExtrasAsMetadata",!1,async n=>{const{ExtrasAsMetadata:t}=await i(async()=>{const{ExtrasAsMetadata:e}=await import("./babylonjs.js").then(a=>a.l);return{ExtrasAsMetadata:e}},[]);return new t(n)}),r("KHR_animation_pointer",!0,async n=>{const{KHR_animation_pointer:t}=await i(async()=>{const{KHR_animation_pointer:e}=await import("./babylonjs.js").then(a=>a.K);return{KHR_animation_pointer:e}},[]);return new t(n)}),r("KHR_draco_mesh_compression",!0,async n=>{const{KHR_draco_mesh_compression:t}=await i(async()=>{const{KHR_draco_mesh_compression:e}=await import("./babylonjs.js").then(a=>a.m);return{KHR_draco_mesh_compression:e}},[]);return new t(n)}),r("KHR_interactivity",!0,async n=>{const{KHR_interactivity:t}=await i(async()=>{const{KHR_interactivity:e}=await import("./babylonjs.js").then(a=>a.n);return{KHR_interactivity:e}},[]);return new t(n)}),r("KHR_lights_punctual",!0,async n=>{const{KHR_lights:t}=await i(async()=>{const{KHR_lights:e}=await import("./babylonjs.js").then(a=>a.o);return{KHR_lights:e}},[]);return new t(n)}),r("EXT_lights_ies",!0,async n=>{const{EXT_lights_ies:t}=await i(async()=>{const{EXT_lights_ies:e}=await import("./babylonjs.js").then(a=>a.p);return{EXT_lights_ies:e}},[]);return new t(n)}),r("KHR_materials_anisotropy",!0,async n=>{const{KHR_materials_anisotropy:t}=await i(async()=>{const{KHR_materials_anisotropy:e}=await import("./babylonjs.js").then(a=>a.q);return{KHR_materials_anisotropy:e}},[]);return new t(n)}),r("KHR_materials_clearcoat",!0,async n=>{const{KHR_materials_clearcoat:t}=await i(async()=>{const{KHR_materials_clearcoat:e}=await import("./babylonjs.js").then(a=>a.s);return{KHR_materials_clearcoat:e}},[]);return new t(n)}),r("KHR_materials_diffuse_transmission",!0,async n=>{const{KHR_materials_diffuse_transmission:t}=await i(async()=>{const{KHR_materials_diffuse_transmission:e}=await import("./babylonjs.js").then(a=>a.t);return{KHR_materials_diffuse_transmission:e}},[]);return new t(n)}),r("KHR_materials_dispersion",!0,async n=>{const{KHR_materials_dispersion:t}=await i(async()=>{const{KHR_materials_dispersion:e}=await import("./babylonjs.js").then(a=>a.u);return{KHR_materials_dispersion:e}},[]);return new t(n)}),r("KHR_materials_emissive_strength",!0,async n=>{const{KHR_materials_emissive_strength:t}=await i(async()=>{const{KHR_materials_emissive_strength:e}=await import("./babylonjs.js").then(a=>a.v);return{KHR_materials_emissive_strength:e}},[]);return new t(n)}),r("KHR_materials_ior",!0,async n=>{const{KHR_materials_ior:t}=await i(async()=>{const{KHR_materials_ior:e}=await import("./babylonjs.js").then(a=>a.w);return{KHR_materials_ior:e}},[]);return new t(n)}),r("KHR_materials_iridescence",!0,async n=>{const{KHR_materials_iridescence:t}=await i(async()=>{const{KHR_materials_iridescence:e}=await import("./babylonjs.js").then(a=>a.x);return{KHR_materials_iridescence:e}},[]);return new t(n)}),r("KHR_materials_pbrSpecularGlossiness",!0,async n=>{const{KHR_materials_pbrSpecularGlossiness:t}=await i(async()=>{const{KHR_materials_pbrSpecularGlossiness:e}=await import("./babylonjs.js").then(a=>a.y);return{KHR_materials_pbrSpecularGlossiness:e}},[]);return new t(n)}),r("KHR_materials_sheen",!0,async n=>{const{KHR_materials_sheen:t}=await i(async()=>{const{KHR_materials_sheen:e}=await import("./babylonjs.js").then(a=>a.z);return{KHR_materials_sheen:e}},[]);return new t(n)}),r("KHR_materials_specular",!0,async n=>{const{KHR_materials_specular:t}=await i(async()=>{const{KHR_materials_specular:e}=await import("./babylonjs.js").then(a=>a.B);return{KHR_materials_specular:e}},[]);return new t(n)}),r("KHR_materials_transmission",!0,async n=>{const{KHR_materials_transmission:t}=await i(async()=>{const{KHR_materials_transmission:e}=await import("./babylonjs.js").then(a=>a.F);return{KHR_materials_transmission:e}},[]);return new t(n)}),r("KHR_materials_unlit",!0,async n=>{const{KHR_materials_unlit:t}=await i(async()=>{const{KHR_materials_unlit:e}=await import("./babylonjs.js").then(a=>a.J);return{KHR_materials_unlit:e}},[]);return new t(n)}),r("KHR_materials_variants",!0,async n=>{const{KHR_materials_variants:t}=await i(async()=>{const{KHR_materials_variants:e}=await import("./babylonjs.js").then(a=>a.L);return{KHR_materials_variants:e}},[]);return new t(n)}),r("KHR_materials_volume",!0,async n=>{const{KHR_materials_volume:t}=await i(async()=>{const{KHR_materials_volume:e}=await import("./babylonjs.js").then(a=>a.N);return{KHR_materials_volume:e}},[]);return new t(n)}),r("KHR_mesh_quantization",!0,async n=>{const{KHR_mesh_quantization:t}=await i(async()=>{const{KHR_mesh_quantization:e}=await import("./babylonjs.js").then(a=>a.P);return{KHR_mesh_quantization:e}},[]);return new t(n)}),r("KHR_texture_basisu",!0,async n=>{const{KHR_texture_basisu:t}=await i(async()=>{const{KHR_texture_basisu:e}=await import("./babylonjs.js").then(a=>a.T);return{KHR_texture_basisu:e}},[]);return new t(n)}),r("KHR_texture_transform",!0,async n=>{const{KHR_texture_transform:t}=await i(async()=>{const{KHR_texture_transform:e}=await import("./babylonjs.js").then(a=>a.U);return{KHR_texture_transform:e}},[]);return new t(n)}),r("KHR_xmp_json_ld",!0,async n=>{const{KHR_xmp_json_ld:t}=await i(async()=>{const{KHR_xmp_json_ld:e}=await import("./babylonjs.js").then(a=>a.W);return{KHR_xmp_json_ld:e}},[]);return new t(n)}),r("MSFT_audio_emitter",!0,async n=>{const{MSFT_audio_emitter:t}=await i(async()=>{const{MSFT_audio_emitter:e}=await import("./babylonjs.js").then(a=>a.X);return{MSFT_audio_emitter:e}},[]);return new t(n)}),r("MSFT_lod",!0,async n=>{const{MSFT_lod:t}=await i(async()=>{const{MSFT_lod:e}=await import("./babylonjs.js").then(a=>a.Y);return{MSFT_lod:e}},[]);return new t(n)}),r("MSFT_minecraftMesh",!0,async n=>{const{MSFT_minecraftMesh:t}=await i(async()=>{const{MSFT_minecraftMesh:e}=await import("./babylonjs.js").then(a=>a.Z);return{MSFT_minecraftMesh:e}},[]);return new t(n)}),r("MSFT_sRGBFactors",!0,async n=>{const{MSFT_sRGBFactors:t}=await i(async()=>{const{MSFT_sRGBFactors:e}=await import("./babylonjs.js").then(a=>a.$);return{MSFT_sRGBFactors:e}},[]);return new t(n)}),r("KHR_node_visibility",!0,async n=>{const{KHR_node_visibility:t}=await i(async()=>{const{KHR_node_visibility:e}=await import("./babylonjs.js").then(a=>a.a0);return{KHR_node_visibility:e}},[]);return new t(n)}),r("KHR_node_hoverability",!0,async n=>{const{KHR_node_hoverability:t}=await i(async()=>{const{KHR_node_hoverability:e}=await import("./babylonjs.js").then(a=>a.a1);return{KHR_node_hoverability:e}},[]);return new t(n)}),r("KHR_node_selectability",!0,async n=>{const{KHR_node_selectability:t}=await i(async()=>{const{KHR_node_selectability:e}=await import("./babylonjs.js").then(a=>a.a2);return{KHR_node_selectability:e}},[]);return new t(n)})}function Q(){R({...g,createPlugin:async n=>{const{GLTFFileLoader:t}=await i(async()=>{const{GLTFFileLoader:e}=await import("./babylonjs.js").then(a=>a.g);return{GLTFFileLoader:e}},[]);return new t(n[g.name])}}),z(),R({...T,createPlugin:async n=>{const{OBJFileLoader:t}=await i(async()=>{const{OBJFileLoader:e}=await import("./babylonjs.js").then(a=>a.a3);return{OBJFileLoader:e}},[]);return new t(n[T.name])}}),R({...f,createPlugin:async n=>{const{SPLATFileLoader:t}=await i(async()=>{const{SPLATFileLoader:e}=await import("./babylonjs.js").then(a=>a.a4);return{SPLATFileLoader:e}},[]);return new t(n[f.name])}}),R({...I,createPlugin:async()=>{const{STLFileLoader:n}=await i(async()=>{const{STLFileLoader:t}=await import("./babylonjs.js").then(e=>e.a5);return{STLFileLoader:t}},[]);return new n}})}function U(n){document.getElementById("log").innerText=n}class j{constructor(t){_(this,"buttonState",3);_(this,"startPointerX",0);_(this,"startPointerY",0);_(this,"lastPointerX",0);_(this,"lastPointerY",0);_(this,"mesh");_(this,"originalRotation");_(this,"evCache",[]);_(this,"prevDiff",-1);_(this,"preventDefault",t=>{t.preventDefault(),t.stopPropagation()});_(this,"canvas",null);this.mesh=t,this.originalRotation=t.rotationQuaternion??w.FromEulerVector(new h(0,0,0))}onPointerMove(t){const e=t.clientX-this.lastPointerX,a=t.clientY-this.lastPointerY;switch(this.buttonState){case 0:this.mesh.position=this.mesh.position.add(new h(e*.01,-a*.01,0));break;case 2:console.log(`this.mesh.rotationQuaternion: ${this.mesh.rotationQuaternion}`),this.mesh.rotationQuaternion=new w((this.startPointerY-t.clientY)*.005,(this.startPointerX-t.clientX)*.005,0,1).multiply(this.originalRotation).normalize();break;case 1:this.mesh.scaling=this.mesh.scaling.add(new h(-a*.01,-a*.01,-a*.01));break}this.lastPointerX=t.clientX,this.lastPointerY=t.clientY}onPointerDown(t){switch(t.button){case 0:this.buttonState=0;break;case 1:this.buttonState=1;break;case 2:this.buttonState=2;break}}onPointerUp(){this.originalRotation=this.mesh.rotationQuaternion??w.Zero(),this.buttonState=3}pointerdown_handler(t){console.log("pointerdown_handler",t),this.evCache.push(t),this.evCache.length==1?(this.startPointerX=this.lastPointerX=t.clientX,this.startPointerY=this.lastPointerY=t.clientY,this.onPointerDown(t)):this.evCache.length==3&&(this.startPointerX=this.lastPointerX=(this.evCache[2].clientX+this.evCache[1].clientX+this.evCache[0].clientX)/2,this.startPointerY=this.lastPointerY=(this.evCache[2].clientY+this.evCache[1].clientY+this.evCache[0].clientY)/2),this.preventDefault(t)}pointermove_handler(t){for(let e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(this.evCache.length==1)this.onPointerMove(this.evCache[0]);else if(this.evCache.length==3){const e=(this.evCache[2].clientX+this.evCache[1].clientX+this.evCache[0].clientX)/2,a=(this.evCache[2].clientY+this.evCache[1].clientY+this.evCache[0].clientY)/2;this.mesh.rotationQuaternion=this.originalRotation.multiply(new w((this.startPointerY-a)*.005,(this.startPointerX-e)*.005,0,1)).normalize()}else if(this.evCache.length==2){const e=Math.sqrt(Math.pow(this.evCache[1].clientX-this.evCache[0].clientX,2)+Math.pow(this.evCache[1].clientY-this.evCache[0].clientY,2));if(this.prevDiff>0){const a=(e-this.prevDiff)*.005;this.mesh.scaling=this.mesh.scaling.add(new h(a,a,a))}this.prevDiff=e}this.preventDefault(t)}pointerup_handler(t){this.remove_event(t),this.evCache.length<3&&(this.prevDiff=-1),this.evCache.length==0&&this.onPointerUp(),this.preventDefault(t)}remove_event(t){for(let e=0;e<this.evCache.length;e++)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}}attachToCanvas(t){this.canvas=t,t.onpointerdown=e=>this.pointerdown_handler(e),t.onpointermove=e=>this.pointermove_handler(e),t.onpointerup=e=>this.pointerup_handler(e),t.onpointercancel=e=>this.pointerup_handler(e),t.onpointerout=e=>this.pointerup_handler(e),t.onpointerleave=e=>this.pointerup_handler(e),t.oncontextmenu=e=>this.preventDefault(e),t.ondragover=e=>this.preventDefault(e),t.ondragenter=e=>this.preventDefault(e),t.ondragleave=e=>this.preventDefault(e)}dispose(){this.canvas!=null&&(this.canvas.onpointerdown=null,this.canvas.onpointermove=null,this.canvas.onpointerup=null,this.canvas.onpointercancel=null,this.canvas.onpointerout=null,this.canvas.onpointerleave=null)}}Q();let v=null,d=null;const s=document.getElementById("renderCanvas");let o=null,E=null,l=null,u,p=null;const q=new A(s,"Loading","black"),P=()=>new O(s,!1,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1});function $(){l!=null&&l.activeCamera&&l.render(!1,!0)}async function J(n,t){const e={width:s.width,height:s.height};let a=k(s.width,s.height);s.width=a.width,s.height=a.height,n.render(!1,!0),U(`VIDEO: ${s.width} x ${s.height}`),s.toBlob(c=>{const m=document.createElement("a");m.href=URL.createObjectURL(c),m.download=`splat_${Y.now().toFormat("yyyy_LL_dd_HH_mm_ss")}.jpg`,m.click(),console.log("Success! Saved cropped splat as splat.png")},"image/jpeg",1),s.width=e.width,s.height=e.height}let y;const N=function(){const n=new b(o),t=new V("Camera",-Math.PI/2,Math.PI/2,20,new h(0,0,0),n);t.useFramingBehavior=!0,M(document.getElementById("splat_url").value,n).then(a=>{u=a.meshes[0],o==null||o.hideLoadingUI(),u.position.set(0,0,-3),u.scaling.set(1,1,1),u.rotationQuaternion=w.FromEulerVector(new h(0,0,0)),d=new X("vt",v==null?void 0:v.videoCanvas,{scene:n,engine:o,samplingMode:L.TEXTURE_BILINEAR_SAMPLINGMODE,generateMipMaps:!1}),window.setInterval(()=>{d==null||d.update()},50),y=S.CreatePlane("plane",{width:1,height:1},n),y.billboardMode=F.BILLBOARDMODE_ALL;const c=new x("RTT material",n);c.transparencyMode=3,c.alphaMode=L.ALPHA_COMBINE,c.emissiveTexture=d,c.disableLighting=!0,y.material=c,H(),n.onDispose=function(){p==null||p.dispose()},p=new j(u),p.attachToCanvas(s),o==null||o.runRenderLoop($)});const e=document.getElementById("screenshotBtn");return e!=null&&e.addEventListener("click",async()=>{u&&await J(n)}),n};function H(){const n=l==null?void 0:l.activeCamera,t=n.fov,e=o.getAspectRatio(n),c=2*n.position.length()*Math.tan(t/2),m=c*e;y.scaling.set(m,c,1)}async function W(){o=await async function(){try{return P()}catch{return console.log("the available createEngine function failed. Creating the default engine instead"),P()}}(),o.loadingScreen=q,o.displayLoadingUI(),E=N(),E.autoClearDepthAndStencil=!0,E.clearColor=new C(0,0,0,0)}W().then(()=>{l=E,v=new B(s),G.init()});window.addEventListener("resize",function(){o==null||o.resize(),H()});
