"use strict";var e=Object.defineProperty,i=(i,t,s)=>((i,t,s)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s)(i,"symbol"!=typeof t?t+"":t,s);exports.FullscreenEngine=class{static init(){const e=document.documentElement,i=document.getElementById("fullscreenBtn");let t=!1;null!=i&&i.addEventListener("click",(async()=>{t?(t=!1,document.exitFullscreen?document.exitFullscreen().then():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(t=!0,e.requestFullscreen?e.requestFullscreen({navigationUI:"hide"}).then():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}))}},exports.VideoEngine=class{constructor(e){i(this,"videoCanvas"),i(this,"renderCanvas"),i(this,"video"),i(this,"video_frame_id",null),i(this,"supports",null),i(this,"facingMode","user"),this.renderCanvas=e,this.video=document.createElement("video"),this.video.disablePictureInPicture=!0,this.video.autoplay=!0,this.video.controls=!1,this.video.playsInline=!0,document.body.appendChild(this.video),this.video.style.display="none",this.videoCanvas=document.createElement("canvas");window.document.getElementById("videoScreen").appendChild(this.videoCanvas),this.supports=navigator.mediaDevices.getSupportedConstraints();const t={audio:!1,video:this.supports.facingMode?{facingMode:this.facingMode}:{}};navigator.mediaDevices.getUserMedia(t).then((e=>this.handleSuccess(e))).catch((e=>this.handleError(e)));const s=document.getElementById("facingModeButton");if(null!=s){const e=e=>{e.preventDefault(),e.stopPropagation()};s.addEventListener("click",(async i=>{e(i);this.video.srcObject.getTracks().forEach((e=>e.stop())),this.facingMode="user"===this.facingMode?"environment":"user";const t={audio:!1,video:this.supports.facingMode?{facingMode:{exact:this.facingMode}}:{}},s=await navigator.mediaDevices.getUserMedia(t);this.video.srcObject=null,this.video.srcObject=s,this.video.play().then()}))}}videoFrame(){let e=this.video.videoWidth,i=this.video.videoHeight,t=this.renderCanvas.width,s=this.renderCanvas.height;const n=t/s;let o,a;e/i<n?(o=0,a=(i-e/n)/2,i=e/n):(o=(e-i*n)/2,a=0,e=i*n),t=960,s=1280,this.videoCanvas.width=t,this.videoCanvas.height=s,this.videoCanvas.getContext("2d").drawImage(this.video,o,a,e,i,0,0,t,s),null!=this.video_frame_id&&cancelAnimationFrame(this.video_frame_id),setTimeout((()=>{this.video_frame_id=requestAnimationFrame((()=>{this.videoFrame()}))}),50)}handleSuccess(e){this.video.srcObject=e,null!=this.video_frame_id&&cancelAnimationFrame(this.video_frame_id),this.video_frame_id=requestAnimationFrame((()=>{this.videoFrame()}))}handleError(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name,e.stack)}};
