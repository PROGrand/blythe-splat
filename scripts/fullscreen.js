var h=Object.defineProperty;var v=(i,e,t)=>e in i?h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>v(i,typeof e!="symbol"?e+"":e,t);class g{constructor(e){d(this,"videoCanvas");d(this,"renderCanvas");d(this,"video");d(this,"video_frame_id",null);d(this,"supports",null);d(this,"facingMode",null);this.renderCanvas=e,this.video=document.createElement("video"),this.video.disablePictureInPicture=!0,this.video.autoplay=!0,this.video.controls=!1,this.video.playsInline=!0,document.body.appendChild(this.video),this.video.style.display="none",this.videoCanvas=document.createElement("canvas"),window.document.getElementById("videoScreen").appendChild(this.videoCanvas),this.supports=navigator.mediaDevices.getSupportedConstraints();const n={audio:!1,video:!0};navigator.mediaDevices.getUserMedia(n).then(a=>this.handleSuccess(a)).catch(a=>this.handleError(a));const s=document.getElementById("facingModeButton");if(s!=null){const a=o=>{o.preventDefault(),o.stopPropagation()};s.addEventListener("click",async o=>{a(o),this.video.srcObject.getTracks().forEach(u=>u.stop()),this.facingMode=this.facingMode==="user"||this.facingMode==null?"environment":"user";const c={audio:!1,video:this.supports.facingMode?{facingMode:{exact:this.facingMode}}:{}},r=await navigator.mediaDevices.getUserMedia(c).catch(u=>navigator.mediaDevices.getUserMedia({audio:!1,video:!0}));this.video.srcObject=null,this.video.srcObject=r,this.video.play().then()})}}videoFrame(){let e=this.video.videoWidth,t=this.video.videoHeight,n=this.renderCanvas.width,s=this.renderCanvas.height;const a=e/t,o=n/s;let l,c;a<o?(l=0,c=(t-e/o)/2,t=e/o):(l=(e-t*o)/2,c=0,e=t*o);const r=m(s,s);n=r.width,s=r.height,this.videoCanvas.width=n,this.videoCanvas.height=s,this.videoCanvas.getContext("2d").drawImage(this.video,l,c,e,t,0,0,n,s),this.video_frame_id!=null&&cancelAnimationFrame(this.video_frame_id),setTimeout(()=>{this.video_frame_id=requestAnimationFrame(()=>{this.videoFrame()})},50)}handleSuccess(e){this.video.srcObject=e,this.video_frame_id!=null&&cancelAnimationFrame(this.video_frame_id),this.video_frame_id=requestAnimationFrame(()=>{this.videoFrame()})}handleError(e){console.log("navigator.MediaDevices.getUserMedia error: ",e.message,e.name,e.stack)}}function m(i,e,t=2160){return i>e?{width:t,height:e*t/i}:{width:i*t/e,height:t}}class p{static init(){const e=document.documentElement,t=document.getElementById("fullscreenBtn"),n=document.getElementById("fullscreenOffBtn");t.addEventListener("click",async()=>{t.style.display="none",n.style.display="inline",s()}),n.addEventListener("click",async()=>{t.style.display="inline",n.style.display="none",a()});function s(){e.requestFullscreen?e.requestFullscreen({navigationUI:"hide"}).then():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function a(){document.exitFullscreen?document.exitFullscreen().then():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}}}export{p as F,g as V,m as s};
